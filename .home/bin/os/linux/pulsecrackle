#!/usr/bin/env bash
set -e

powersave="`cat /sys/module/snd_hda_intel/parameters/power_save`"
if [[ "$powersave" == 1 ]]; then
  echo "0" | sudo tee /sys/module/snd_hda_intel/parameters/power_save
  echo "0" | sudo tee /sys/module/snd_hda_intel/parameters/power_save_controller

  read -rep 'apply? ' \
    && echo "options snd_hda_intel power_save=0" | sudo tee -a /etc/modprobe.d/audio_disable_powersave.conf \
    && echo "options snd_hda_intel power_save_controller=0" | sudo tee -a /etc/modprobe.d/audio_disable_powersave_controller.conf
fi
